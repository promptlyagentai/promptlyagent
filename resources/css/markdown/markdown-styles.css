/**
 * Markdown Content Styling for PromptlyAgent
 *
 * Comprehensive markdown rendering styles for AI-generated content, documentation,
 * and user-created markdown. Includes support for:
 * - Typography hierarchy (h1-h6, paragraphs, lists)
 * - Code blocks with Prism.js syntax highlighting
 * - Tables with responsive scrolling
 * - Blockquotes, links, images
 * - Compact variant for artifact previews
 *
 * Theme Integration:
 * - Uses semantic tokens from _base-tokens.css
 * - Automatic light/dark mode adaptation
 * - Consistent code block styling with hljs-custom-theme.css
 *
 * Key Classes:
 * - .markdown: Main container for all markdown content
 * - .markdown-compact: Reduced spacing variant for previews
 *
 * @see resources/css/themes/_base-tokens.css - Semantic color tokens
 * @see resources/css/hljs-custom-theme.css - Code syntax highlighting
 */

@layer utilities {
    /* ============================================
       BASE CONTAINER
       ============================================ */

    .markdown {
        @apply text-primary leading-relaxed;
        line-height: 1.7;
    }

    /* ============================================
       TYPOGRAPHY - HEADINGS
       Six levels with semantic spacing and borders
       ============================================ */
    .markdown h1 {
        @apply text-3xl font-bold text-primary mt-8 mb-6 pb-3 border-b border-default;
        line-height: 1.3;
    }

    .markdown h2 {
        @apply text-2xl font-semibold text-primary mt-8 mb-4 pb-2 border-b border-default;
        line-height: 1.4;
    }

    .markdown h3 {
        @apply text-xl font-semibold text-primary mt-6 mb-3;
        line-height: 1.4;
    }

    .markdown h4 {
        @apply text-lg font-medium text-primary mt-5 mb-3;
        line-height: 1.5;
    }

    .markdown h5 {
        @apply text-base font-medium text-primary mt-4 mb-2;
        line-height: 1.5;
    }

    .markdown h6 {
        @apply text-sm font-medium text-primary mt-3 mb-2;
        line-height: 1.5;
    }

    /* First heading in document - remove top margin */
    .markdown h1:first-child,
    .markdown h2:first-child,
    .markdown h3:first-child {
        @apply mt-0;
    }

    /* ============================================
       TYPOGRAPHY - PARAGRAPHS & INLINE
       ============================================ */
    .markdown p {
        @apply mb-4 text-secondary leading-relaxed;
        line-height: 1.7;
    }

    .markdown p:last-child {
        @apply mb-0;
    }

    /* Strong and emphasis */
    .markdown strong {
        @apply font-semibold text-primary;
    }

    .markdown em {
        @apply italic text-secondary;
    }

    /* ============================================
       LISTS - ORDERED & UNORDERED
       Styled markers with proper nesting support
       ============================================ */
    .markdown ul {
        @apply mb-4 pl-6 space-y-1;
    }

    .markdown ol {
        @apply mb-4 pl-6 space-y-1;
    }

    .markdown li {
        @apply text-secondary leading-relaxed;
        line-height: 1.6;
    }

    .markdown ul li {
        @apply list-disc;
    }

    .markdown ol li {
        @apply list-decimal;
    }

    .markdown ul li::marker {
        @apply text-accent;
    }

    .markdown ol li::marker {
        @apply text-accent font-medium;
    }

    /* Nested lists */
    .markdown ul ul,
    .markdown ol ol,
    .markdown ul ol,
    .markdown ol ul {
        @apply mt-2 mb-0 pl-6;
    }

    /* Nested list items */
    .markdown li > ul,
    .markdown li > ol {
        @apply mt-2 mb-0;
    }

    /* List items with nested paragraphs - reset any inherited styles */
    .markdown li > p {
        @apply mb-2;
        background: transparent !important;
        border: none !important;
        border-radius: 0 !important;
        padding: 0 !important;
    }

    .markdown li > p:last-child {
        @apply mb-0;
    }

    /* ============================================
       CODE BLOCKS & INLINE CODE
       Prism.js integration with theme-aware styling
       ============================================ */

    /* Inline code - small snippets within text */
    .markdown :where(code):not(:where([class~="hljs"], pre code)) {
        @apply px-2 py-1 bg-code text-accent rounded-md text-sm font-mono border border-code;
        font-weight: 500;
    }

    /* Code blocks - Prism.js syntax highlighting support */
    .markdown pre {
        @apply my-5 overflow-x-auto rounded-lg shadow-sm;
        position: relative;
        background-color: var(--color-code-bg);
        border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .markdown pre code {
        @apply block p-4 text-sm font-mono leading-relaxed;
        border: none !important;
        margin: 0 !important;
        border-radius: 0 !important;
        line-height: 1.6;
        background: inherit !important; /* Prism.js controls colors */
    }

    /* ============================================
       PRISM.JS TOOLBAR
       Copy button and language indicators
       ============================================ */
    .markdown pre .toolbar {
        @apply flex items-center justify-end p-2 border-b border-default;
        background: rgba(0, 0, 0, 0.05);
    }

    .markdown pre .toolbar-item {
        @apply px-3 py-1 text-xs font-medium text-tertiary bg-surface border border-default rounded hover:opacity-90 transition-colors cursor-pointer;
    }

    .markdown pre .toolbar-item:hover {
        @apply text-primary;
    }

    .markdown pre[class*="language-"] .toolbar {
        display: flex;
    }

    pre:not(.markdown pre) .toolbar {
        display: none !important;
    }

    /* Language label badges - appears above code blocks */
    .markdown pre[class*="language-"]::before {
        content: attr(class);
        @apply absolute -top-3 right-2 px-2 py-1 text-xs font-medium text-tertiary bg-surface border border-default rounded-t-md;
        transform: translateY(-100%);
    }

    /* Prism.js color overrides - use semantic tokens */
    .markdown pre[class*="language-"],
    .markdown :not(pre) > code[class*="language-"] {
        /* Use semantic token for theme-aware backgrounds */
        background: var(--color-code-bg) !important;
        border: 1px solid rgba(255, 255, 255, 0.15) !important;
    }

    .markdown pre[class*="language-"] code {
        color: var(--color-text-primary) !important;
    }

    .markdown pre[class*="language-"] .token {
        background: none !important;
    }

    /* ============================================
       LINE NUMBERS PLUGIN
       Gutter styling for Prism.js line-numbers plugin
       ============================================ */
    .markdown pre.line-numbers {
        position: relative;
        padding-left: 3.8em;
        counter-reset: linenumber;
    }

    .markdown pre.line-numbers > code {
        position: relative;
        white-space: inherit;
        padding-left: 0;
    }

    .markdown .line-numbers .line-numbers-rows {
        position: absolute;
        pointer-events: none;
        top: 0;
        font-size: 100%;
        left: -3.8em;
        width: 3em;
        letter-spacing: -1px;
        border-right: 1px solid rgba(255, 255, 255, 0.2);
        user-select: none;
        background: rgba(0, 0, 0, 0.2);
        padding: 1rem 0.5rem;
    }

    .markdown .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

    .markdown .line-numbers-rows > span:before {
        content: counter(linenumber);
        color: rgba(255, 255, 255, 0.4);
        display: block;
        padding-right: 0.8em;
        text-align: right;
    }

    /* Toolbar positioning adjustment for line numbers */
    .markdown pre .toolbar {
        justify-content: flex-start !important;
        padding-left: 4rem;
    }

    /* ============================================
       LINKS
       Styled with underline animation on hover
       ============================================ */
    .markdown a {
        @apply font-medium text-accent hover:text-accent-hover underline underline-offset-2 transition-colors duration-200;
        text-decoration-thickness: 1px;
    }

    .markdown a:hover {
        @apply underline-offset-4;
        text-decoration-thickness: 2px;
    }

    /* External links - add arrow indicator */
    .markdown a[href^="http"]:not([href*="localhost"]):not([href*="127.0.0.1"]):after {
        content: "â†—";
        @apply inline-block ml-1 text-xs opacity-70;
    }

    /* ============================================
       BLOCKQUOTES & HORIZONTAL RULES
       ============================================ */
    .markdown blockquote {
        @apply my-5 pl-4 border-l-4 border-accent bg-accent/10 p-4 rounded-r-md;
    }

    .markdown blockquote p {
        @apply text-secondary italic mb-0;
    }

    .markdown hr {
        @apply my-8 border-0 border-t border-default;
    }

    /* ============================================
       TABLES
       Responsive tables with horizontal scrolling
       ============================================ */
    .markdown table {
        @apply w-full my-6 border-collapse border border-default rounded-lg overflow-hidden shadow-sm;
    }

    .markdown table th {
        @apply px-4 py-3 text-left text-sm font-semibold text-primary border-b border-default;
        white-space: nowrap;
        background-color: var(--color-surface) !important;
    }

    .markdown table td {
        @apply px-4 py-3 text-sm text-secondary border-b border-subtle;
    }

    .markdown table tbody tr:hover {
        background-color: color-mix(in srgb, var(--color-surface) 50%, transparent);
    }

    .markdown table tbody tr:last-child td {
        @apply border-b-0;
    }

    /* ============================================
       TABLE SCROLLING WRAPPER
       Horizontal scroll with visual indicators
       ============================================ */
    .markdown .table-wrapper {
        @apply overflow-x-auto my-6 -mx-4 px-4;
        scrollbar-width: thin;
        scrollbar-color: rgba(156, 163, 175, 0.5) transparent;
    }

    .markdown .table-wrapper::-webkit-scrollbar {
        height: 8px;
    }

    .markdown .table-wrapper::-webkit-scrollbar-track {
        background: transparent;
    }

    .markdown .table-wrapper::-webkit-scrollbar-thumb {
        @apply bg-surface rounded-full border border-default;
    }

    .markdown .table-wrapper::-webkit-scrollbar-thumb:hover {
        background-color: color-mix(in srgb, var(--color-surface) 80%, transparent);
    }

    /* Gradient shadows to indicate scrollable content */
    .markdown .table-wrapper {
        position: relative;
        background:
            linear-gradient(to right, white 30%, rgba(255, 255, 255, 0)) 0 0,
            linear-gradient(to left, white 30%, rgba(255, 255, 255, 0)) 100% 0;
        background-repeat: no-repeat;
        background-color: white;
        background-size: 40px 100%, 40px 100%;
        background-attachment: local, local;
    }

    .dark .markdown .table-wrapper {
        background:
            linear-gradient(to right, rgb(31, 41, 55) 30%, rgba(31, 41, 55, 0)) 0 0,
            linear-gradient(to left, rgb(31, 41, 55) 30%, rgba(31, 41, 55, 0)) 100% 0;
        background-repeat: no-repeat;
        background-color: rgb(31, 41, 55);
        background-size: 40px 100%, 40px 100%;
        background-attachment: local, local;
    }

    .markdown .table-wrapper table {
        @apply my-0;
        min-width: 100%;
    }

    /* ============================================
       IMAGES
       Responsive with borders and shadows
       ============================================ */
    .markdown img {
        @apply max-w-full h-auto rounded-lg shadow-sm my-6 border border-default;
    }

    /* ============================================
       DOCUMENTATION ELEMENTS
       Specialized styling for API docs and technical content
       ============================================ */

    /* Description lists - for API parameters, glossaries */
    .markdown dl {
        @apply my-4;
    }

    .markdown dt {
        @apply font-semibold text-primary mt-4 mb-2;
    }

    .markdown dd {
        @apply text-secondary mb-3 pl-4;
    }

    /* Tighter spacing after headings */
    .markdown h2 + p,
    .markdown h3 + p,
    .markdown h4 + p {
        @apply mt-2;
    }

    /* Strong emphasis on inline code */
    .markdown strong code {
        @apply bg-code text-accent border-code;
    }

    /* List spacing after headings */
    .markdown h2 + ul,
    .markdown h3 + ul,
    .markdown h2 + ol,
    .markdown h3 + ol {
        @apply mt-3;
    }

    /* ============================================
       SPECIAL STYLING PATTERNS
       Workflow displays, callouts, badges
       ============================================ */

    /* Remove top margin from first heading */
    .markdown h1:first-child {
        @apply mt-0;
    }

    /* Badge-like elements - styled emphasis paragraphs */
    .markdown > p:first-child:has(strong) {
        @apply bg-accent/10 border border-accent rounded-lg p-3 mb-4;
    }

    /* Summary section containers */
    .markdown h2:contains("Summary") {
        @apply bg-surface -mx-4 px-4 py-2 rounded-t-lg border-b-0 mt-6;
    }

    .markdown h2:contains("Summary") + ul {
        @apply bg-surface -mx-4 px-4 pb-4 rounded-b-lg border border-default border-t-0;
    }

    /* ============================================
       CALLOUT BOXES
       Note, warning, and error alerts
       ============================================ */
    .markdown .callout {
        @apply my-4 p-4 rounded-lg border-l-4;
    }

    .markdown .callout.note {
        @apply bg-accent/10 border-accent;
    }

    .markdown .callout.warning {
        @apply bg-yellow-50 dark:bg-yellow-900/20 border-yellow-500 dark:border-yellow-400;
    }

    .markdown .callout.error {
        @apply bg-red-50 dark:bg-red-900/20 border-red-500 dark:border-red-400;
    }

    /* ============================================
       SPACING UTILITIES
       Consistent vertical rhythm
       ============================================ */
    .markdown h1 + h2,
    .markdown h2 + h3,
    .markdown h3 + h4 {
        @apply mt-4;
    }

    /* Flow spacing for adjacent elements */
    .markdown > * + * {
        margin-top: 1.25rem;
    }

    .markdown li > * + * {
        margin-top: 0.5rem;
    }

    /* ============================================
       COMPACT VARIANT
       Reduced spacing for artifact previews and embedded content
       ============================================ */
    .markdown-compact .markdown h1 {
        @apply mt-3 mb-2 text-xl;
        padding-bottom: 0 !important;
        border-bottom: 0 !important;
    }

    .markdown-compact .markdown h2 {
        @apply mt-3 mb-2 text-lg;
        padding-bottom: 0 !important;
        border-bottom: 0 !important;
    }

    .markdown-compact .markdown h3 {
        @apply mt-2 mb-1 text-base;
    }

    .markdown-compact .markdown h4,
    .markdown-compact .markdown h5,
    .markdown-compact .markdown h6 {
        @apply mt-2 mb-1 text-sm;
    }

    .markdown-compact .markdown h1:first-child,
    .markdown-compact .markdown h2:first-child,
    .markdown-compact .markdown h3:first-child {
        margin-top: 0 !important;
    }

    .markdown-compact .markdown p {
        margin-bottom: 0.5rem !important;
    }

    .markdown-compact .markdown p:last-child {
        margin-bottom: 0 !important;
    }

    .markdown-compact .markdown ul,
    .markdown-compact .markdown ol {
        margin-bottom: 0.5rem !important;
        margin-top: 0.5rem !important;
    }

    .markdown-compact .markdown li {
        margin-bottom: 0.25rem !important;
    }

    /* Reduce spacing between consecutive elements */
    .markdown-compact .markdown > * + * {
        margin-top: 0.75rem !important;
    }

    .markdown-compact .markdown li > * + * {
        margin-top: 0.25rem !important;
    }

    .markdown-compact .markdown ul ul,
    .markdown-compact .markdown ol ol,
    .markdown-compact .markdown ul ol,
    .markdown-compact .markdown ol ul {
        margin-top: 0.25rem !important;
        margin-bottom: 0 !important;
    }

    /* ============================================
       RESPONSIVE DESIGN
       Mobile-optimized typography and tables
       ============================================ */
    @media (max-width: 640px) {
        .markdown h1 {
            @apply text-2xl;
        }

        .markdown h2 {
            @apply text-xl;
        }

        .markdown h3 {
            @apply text-lg;
        }

        .markdown pre {
            @apply mx-0;
        }

        .markdown pre code {
            @apply text-xs;
        }

        .markdown table {
            @apply text-xs;
        }

        /* Mobile table wrapper with momentum scrolling */
        .markdown .table-wrapper {
            @apply -mx-2 px-2;
            -webkit-overflow-scrolling: touch;
            scroll-snap-type: x proximity;
        }

        .markdown .table-wrapper table {
            min-width: max-content;
        }

        /* Column snap points for smooth scrolling */
        .markdown table th,
        .markdown table td {
            @apply px-3 py-2;
            scroll-snap-align: start;
            min-width: 120px;
        }

        /* Sticky first column for context while scrolling */
        .markdown table th:first-child,
        .markdown table td:first-child {
            position: sticky;
            left: 0;
            z-index: 1;
            @apply bg-surface;
            box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
        }

        /* Visible scrollbar for mobile discoverability */
        .markdown .table-wrapper::-webkit-scrollbar {
            height: 6px;
        }

        .markdown .table-wrapper::-webkit-scrollbar-thumb {
            @apply bg-surface border border-default;
        }
    }
}
